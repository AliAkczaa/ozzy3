/* Import czcionki z Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

/* --- Podstawowe style globalne --- */
body {
    margin: 0;
    overflow: hidden; /* Zapobiega przewijaniu */
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* Pełna wysokość viewportu */
    background: linear-gradient(to bottom, #4a0000, #000000); /* Stonksowe tło */
    font-family: 'Press Start 2P', cursive;
    color: #eee;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    position: relative; /* Dla pozycjonowania message-display */
    user-select: none; /* Zapobiegaj zaznaczaniu tekstu/elementów */
    -webkit-user-drag: none; /* Zapobiegaj przeciąganiu na WebKit */
}

/* Klasa do ukrywania elementów */
.hidden {
    display: none !important; /* Ważne, aby wymusić ukrycie */
}

/* Kontener główny gry */
#game-container {
    width: 100vw; /* Pełna szerokość viewportu */
    height: 100vh; /* Pełna wysokość viewportu */
    max-width: 1200px; /* Maksymalna szerokość na większych ekranach */
    max-height: 800px; /* Maksymalna wysokość na większych ekranach */
    position: relative;
    overflow: hidden; /* Upewnij się, że nic nie wykracza poza kontener */
    border: 5px solid #8B0000; /* Ciemnoczerwona ramka */
    box-shadow: 0 0 50px rgba(255, 0, 0, 0.5); /* Czerwony cień */
    background-color: #000; /* Domyślne tło */
}

/* Animowane tło traktora */
#animated-background-tractor {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover; /* Pokryj cały kontener */
    z-index: 1; /* Pod warstwami gry */
    filter: brightness(0.7) grayscale(0.5); /* Ciemniejsze i mniej kolorowe */
    animation: background-pan 30s linear infinite alternate; /* Dłuższa animacja */
}

@keyframes background-pan {
    0% { transform: scale(1); }
    100% { transform: scale(1.1); } /* Lekkie powiększanie */
}

/* Canvas dla wszystkich dynamicznych efektów (boss, supermoce) */
#boss-effect-canvas { /* ID canvasa pozostało 'boss-effect-canvas' */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 150; /* Nad ozzy-container, ale pod message-display */
    pointer-events: none;
    opacity: 0; /* Domyślnie ukryty, pokazywany przez JS */
    transition: opacity 0.5s ease-in-out;
}

#boss-effect-canvas.active {
    opacity: 1; /* Aktywacja */
}

/* Kontenery na efekty supermocy (tylko tło/pełnoekranowe rozbłyski) */
.effect-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100; /* Nad wszystkimi elementami gry poza canvasem i komunikatami */
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease-out;
}

.effect-overlay.active {
    opacity: 1;
}

/* Efekty błyskawicy (overlay) */
#lightning-effect.flash-active {
    opacity: 1;
    background: radial-gradient(circle, rgba(255, 255, 0, 0.4) 0%, rgba(255, 140, 0, 0) 70%);
}

/* Efekty lodu (overlay) */
#freeze-effect {
    background-color: transparent; 
    opacity: 0;
    transition: background-color 0.5s ease-out, opacity 0.5s ease-out;
}

#freeze-effect.active {
    background-color: rgba(173, 216, 230, 0.3);
    animation: freezeEffectGlow 1s infinite alternate;
    opacity: 1;
}

@keyframes freezeEffectGlow {
    0% { background-color: rgba(173, 216, 230, 0.3); }
    100% { background-color: rgba(173, 216, 230, 0.6); }
}

/* Efekty szału bojowego (overlay) */
#frenzy-effect {
    background: radial-gradient(circle, rgba(255, 69, 0, 0.3) 0%, rgba(139, 0, 0, 0) 70%);
}

#frenzy-effect.active {
    animation: frenzyEffectPulse 0.5s infinite alternate;
}

@keyframes frenzyEffectPulse {
    0% { background-color: rgba(255, 69, 0, 0.3); transform: scale(1); }
    100% { background-color: rgba(255, 69, 0, 0.5); transform: scale(1.02); }
}


/* Kontener na obrazki z cytatami (np. memes) */
#quote-images-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 15; 
    pointer-events: none;
    overflow: hidden;
}

.quote-image {
    position: absolute;
    /* ZMIANA: Responsywne rozmiary dla obrazków cytatów */
    width: clamp(80px, 15vw, 150px); 
    height: clamp(80px, 15vw, 150px);
    object-fit: contain; /* Upewnij się, że obrazek mieści się w ramce */
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    z-index: 55; /* Zawsze nad Ozzy'm */
}

.quote-image.active {
    opacity: 1;
    transform: scale(1);
}

/* Kontener dla Ozzy'ego */
#ozzy-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Centrowanie */
    z-index: 20; /* Nad tłem i cytatami, ale pod canvasem efektów */
    cursor: url('stonks.png'), auto; /* Zmieniony kursor na Stonks */
    transition: transform 0.1s ease-out; /* Płynne poruszanie */
    user-select: none; /* Zapobiegaj zaznaczaniu */
    -webkit-user-drag: none; /* Zapobiegaj przeciąganiu */
}

#ozzy-image {
    width: clamp(150px, 40vw, 300px); /* Responsywny rozmiar */
    height: auto;
    display: block;
    filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5)); /* Efekt blasku */
    transition: filter 0.1s ease-out, transform 0.1s ease-out; /* Animacja uderzenia */
}

/* Efekt trafienia */
#ozzy-image.hit-effect {
    filter: brightness(1.5) grayscale(0.5) drop-shadow(0 0 20px yellow);
    transform: scale(1.05);
}

/* Animacja pojawiania się Ozzy'ego */
#ozzy-image.spawn-ozzy {
    animation: spawn-pop 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

@keyframes spawn-pop {
    0% { transform: scale(0.5) rotateY(180deg); opacity: 0; }
    70% { transform: scale(1.1) rotateY(-10deg); opacity: 1; }
    100% { transform: scale(1) rotateY(0deg); }
}

/* Tryb Bossa */
#ozzy-image.boss-mode {
    filter: brightness(1.2) contrast(1.2) hue-rotate(180deg) drop-shadow(0 0 30px #FF0000); /* Zmiana wyglądu i czerwony cień */
    transform: scale(1.2); /* Większy rozmiar dla bossa */
    /* Animacje bossa (pionowe poruszanie, migotanie) */
    animation: boss-flicker 1s infinite alternate, boss-pulsate 2s infinite infinite alternate;
}

/* Odwracanie obrazu bossa */
#ozzy-image.flipped-x {
    transform: scaleX(-1); /* Odwrócenie w poziomie */
}

/* Warianty wizualne Stonksa (normalne) */
#ozzy-image.stonks-variant-0 { filter: none; } /* Domyślny */
#ozzy-image.stonks-variant-1 { filter: hue-rotate(30deg) brightness(1.1); }
#ozzy-image.stonks-variant-2 { filter: grayscale(60%) contrast(120%); } /* ZMIANA: Mniej szarości, więcej kontrastu */
#ozzy-image.stonks-variant-3 { filter: invert(50%) saturate(120%); }
#ozzy-image.stonks-variant-4 { filter: contrast(180%) brightness(0.9) hue-rotate(100deg); }
#ozzy-image.stonks-variant-5 { filter: blur(0.3px) saturate(150%) hue-rotate(200deg); }
#ozzy-image.stonks-variant-6 { filter: drop-shadow(0 0 8px #00FF00) brightness(1.3); }
#ozzy-image.stonks-variant-7 { filter: sepia(70%) contrast(150%) brightness(1.1); }
#ozzy-image.stonks-variant-8 { filter: hue-rotate(270deg) saturate(180%) drop-shadow(0 0 10px #FF00FF); }
#ozzy-image.stonks-variant-9 { filter: brightness(0.7) contrast(200%); }

/* Warianty wizualne Bossa (zmodyfikowane) */
#ozzy-image.boss-mode-variant-0 { filter: brightness(1.2) contrast(1.2) hue-rotate(180deg) drop-shadow(0 0 30px #FF0000); }
#ozzy-image.boss-mode-variant-1 { filter: brightness(1.3) contrast(1.3) hue-rotate(200deg) drop-shadow(0 0 35px #FF4500); }
#ozzy-image.boss-mode-variant-2 { filter: brightness(1.4) contrast(1.4) hue-rotate(220deg) drop-shadow(0 0 40px #FFA500); }
#ozzy-image.boss-mode-variant-3 { filter: brightness(1.5) contrast(1.5) hue-rotate(240deg) drop-shadow(0 0 45px #FFD700); }
#ozzy-image.boss-mode-variant-4 { filter: brightness(1.6) contrast(1.6) hue-rotate(260deg) drop-shadow(0 0 50px #FFFF00); }
#ozzy-image.boss-mode-variant-5 { filter: brightness(1.7) contrast(1.7) hue-rotate(280deg) drop-shadow(0 0 55px #7FFF00); }
#ozzy-image.boss-mode-variant-6 { filter: brightness(1.8) contrast(1.8) hue-rotate(300deg) drop-shadow(0 0 60px #00FF00); }
#ozzy-image.boss-mode-variant-7 { filter: brightness(1.9) contrast(1.9) hue-rotate(320deg) drop-shadow(0 0 65px #00FFFF); }
#ozzy-image.boss-mode-variant-8 { filter: brightness(2.0) contrast(2.0) hue-rotate(340deg) drop-shadow(0 0 70px #0000FF); }
#ozzy-image.boss-mode-variant-9 { filter: brightness(2.1) contrast(2.1) hue-rotate(0deg) drop-shadow(0 0 75px #8A2BE2); }


@keyframes boss-flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; } /* Lekkie migotanie */
}

@keyframes boss-pulsate {
    0%, 100% { transform: scale(1.2); }
    50% { transform: scale(1.25); } /* Lekkie pulsowanie */
}


/* Pasek zdrowia */
#health-bar-container {
    width: 80%;
    height: 25px; /* Grubszy pasek */
    background-color: #333;
    border: 3px solid #eee;
    border-radius: 10px;
    margin: 10px auto 0;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
    transform: translateY(-5px); /* Lekko w górę */
}

#health-bar-fill {
    height: 100%;
    width: 100%;
    background-color: limegreen;
    transition: width 0.3s ease-out, background-color 0.3s ease-out;
    border-radius: 7px;
}

/* Ekrany gry (start, koniec, ranking, sklep) - Poprawione pozycjonowanie */
#start-screen, #end-screen, #leaderboard-screen, #upgrade-shop-screen {
    position: absolute;
    top: 50%; /* Centrowanie pionowe */
    left: 50%; /* Centrowanie poziome */
    transform: translate(-50%, -50%); /* Dokładne centrowanie */
    width: 80%; /* Zachowaj responsywność */
    max-width: 500px; /* Maksymalna szerokość */
    background: rgba(0, 0, 0, 0.9); /* Półprzezroczyste tło */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 1000; /* Zawsze na wierzchu */
    padding: 30px; /* Zwiększony padding dla lepszych marginesów wewnętrznych */
    box-sizing: border-box; /* padding wewnątrz szerokości/wysokości */
    max-height: 95vh; /* Mniejszy max-height dla przestrzeni od góry/dołu */
    overflow-y: auto; /* Zapewnij przewijanie, jeśli zawartość przekroczy wysokość */
}


#start-screen h1, #end-screen h2, #leaderboard-screen h2, #upgrade-shop-screen h2 {
    font-size: clamp(1.5em, 6vw, 3em); /* Responsywny rozmiar tekstu */
    color: #FFD700; /* Złoty kolor */
    margin-bottom: 20px;
    text-shadow: 4px 4px 8px rgba(255, 165, 0, 0.8);
}

#start-screen p, #end-screen p, #leaderboard-screen ol, #upgrade-shop-screen p {
    font-size: clamp(0.8em, 3vw, 1.2em);
    margin-bottom: 15px;
}

#nickname-input {
    padding: 10px 15px;
    font-size: clamp(0.8em, 3.5vw, 1.2em);
    margin-bottom: 20px;
    border: 3px solid #FFD700;
    background-color: #333;
    color: #eee;
    border-radius: 8px;
    text-align: center;
    font-family: 'Press Start 2P', cursive;
    max-width: 80%; /* Ograniczenie szerokości */
}

/* Globalne style przycisków */
button {
    background-color: #8B0000; /* Ciemnoczerwony */
    color: #FFD700; /* Złoty tekst */
    padding: 12px 25px;
    margin: 10px;
    border: 3px solid #FFD700;
    border-radius: 8px;
    font-family: 'Press Start 2P', cursive;
    font-size: clamp(0.7em, 3vw, 1em);
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s, transform 0.1s;
    box-shadow: 0 5px 15px rgba(255, 0, 0, 0.5); /* Czerwony cień */
}

button:hover {
    background-color: #FF4500; /* Pomarańczowoczerwony */
    color: #FFF;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 69, 0, 0.7);
}

button:active {
    transform: translateY(0);
    box-shadow: 0 3px 10px rgba(255, 0, 0, 0.5);
}

button:disabled {
    background-color: #555;
    color: #aaa;
    border-color: #777;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

/* Ranking */
#leaderboard-list {
    list-style: none;
    padding: 0;
    max-height: 60vh; /* Ograniczenie wysokości */
    overflow-y: auto; /* Przewijanie dla długiej listy */
    width: clamp(250px, 90vw, 500px);
    margin-top: 20px;
    background-color: rgba(50, 0, 0, 0.8);
    border-radius: 10px;
    padding: 15px;
    border: 2px solid #FFD700;
}

#leaderboard-list li {
    padding: 10px;
    border-bottom: 1px dashed #777;
    font-size: clamp(0.7em, 2.8vw, 1.1em);
    color: #eee;
}

#leaderboard-list li:last-child {
    border-bottom: none;
}

/* Info o grze (wynik, poziom) */
#game-info-container {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 10px 15px;
    border-radius: 8px;
    border: 2px solid #FFD700;
    z-index: 30;
    font-size: clamp(0.7em, 2.5vw, 1em);
}

#game-info-container p {
    margin: 5px 0;
}

/* Przyciski supermocy */
#superpower-buttons-container {
    position: absolute;
    bottom: 10px; /* Domyślna pozycja na desktopie */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 30;
}

.superpower-button {
    background-color: #004d00; /* Ciemnozielony */
    border-color: #00FF00; /* Zielony */
    color: #FFF;
    padding: 10px 15px;
    font-size: clamp(0.7em, 2.5vw, 1em);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    flex-wrap: nowrap; /* Zapobiega łamaniu tekstu */
    width: auto; /* Automatyczna szerokość */
}

.superpower-button:hover {
    background-color: #008000; /* Jaśniejszy zielony */
    border-color: #7FFF00;
}

.superpower-button span {
    white-space: nowrap; /* Zapobiega zawijaniu tekstu */
}

/* Wiadomości dynamiczne */
.knockout-message, .boss-message {
    position: absolute;
    left: 50%; 
    transform: translate(-50%, -50%); 
    background-color: rgba(0, 0, 0, 0.8);
    padding: 20px 30px; 
    border-radius: 10px;
    border: 4px solid #FFD700;
    font-size: clamp(1em, 3.5vw, 2em); 
    text-align: center;
    color: #FFD700;
    z-index: 1000;
    animation: message-pop-fade 2s ease-out forwards;
    white-space: normal; 
    word-break: break-word; 
    max-width: 90%; 
    box-sizing: border-box; 
}

.boss-message {
    border-color: #FF0000;
    color: #FF0000;
    text-shadow: 0 0 10px #FF4500;
    animation: message-pop-fade-boss 2.5s ease-out forwards;
}

@keyframes message-pop-fade {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
}

@keyframes message-pop-fade-boss {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
    10% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(-5deg); }
    20% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
    30% { transform: translate(-50%, -50%) scale(1.2) rotate(-5deg); }
    90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}


/* Styl dla przycisku sklepu */
#shop-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #4CAF50; /* Zielony */
    border-color: #8BC34A; /* Jasnozielony */
    color: white;
    padding: 10px 20px;
    font-size: clamp(0.7em, 3vw, 1.1em);
    z-index: 30; /* Nad innymi elementami gry */
}

#shop-button:hover {
    background-color: #66BB6A; /* Jaśniejszy zielony */
}

/* Sklep ulepszeń */
#upgrade-shop-screen {
    background: rgba(0, 0, 0, 0.95); /* Ciemniejsze tło sklepu */
    border: 5px solid #FFD700; /* Złota ramka */
    border-radius: 15px;
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.7);
    padding: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 80%; /* Zachowaj responsywność */
    max-width: 500px; /* Maksymalna szerokość */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-height: 95vh; /* Daje więcej miejsca na górze/dołu */
    overflow-y: auto; /* Przewijanie, jeśli zawartość jest długa */
}

#upgrade-shop-screen #shop-points {
    color: #FFD700;
    font-size: clamp(0.9em, 3.5vw, 1.3em);
    margin-bottom: 20px;
}

.upgrade-category {
    background-color: rgba(50, 0, 0, 0.8); /* Ciemnoczerwone tło dla kategorii */
    border: 2px solid #FFD700;
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 10px;
    text-align: left;
    width: clamp(250px, 80vw, 450px); /* Responsywna szerokość */
}

.upgrade-category h3 {
    font-size: clamp(0.9em, 3.5vw, 1.5em);
    color: #FFD700;
    margin-top: 0; /* Zapewnia, że nagłówek nie ma dodatkowego marginesu */
    margin-bottom: 10px;
}

.upgrade-category p {
    margin: 5px 0;
    font-size: clamp(0.7em, 3vw, 1.1em);
}

.upgrade-category button {
    margin-top: 10px;
    width: 100%; /* Przycisk na całą szerokość kategorii */
}

#close-shop-button {
    background-color: #B22222; /* Ognista czerwień */
    border-color: #FF6347; /* Jasnoczerwony */
    margin-top: 20px;
    font-size: clamp(0.8em, 3.5vw, 1.2em);
}


/* --- Responsywność dla urządzeń mobilnych --- */
@media (max-width: 768px) {
    #game-container {
        border: none; /* Usuń ramkę na małych ekranach */
        box-shadow: none;
    }

    #ozzy-image {
        width: clamp(100px, 50vw, 250px); /* Mniejszy rozmiar Stonksa */
    }

    #health-bar-container {
        height: 20px; /* Mniejszy pasek zdrowia */
    }

    #superpower-buttons-container {
        bottom: 100px; /* Podniesienie przycisków na mobilnych */
        flex-direction: row; /* Przyciski w rzędzie */
        width: 95%; /* Większa szerokość */
        padding: 5px;
        justify-content: space-around;
        gap: 5px;
    }

    .superpower-button {
        flex: 1; /* Rozciągnij, aby wypełnić dostępną przestrzeń */
        padding: 8px; /* Kwadratowe przyciski, wystarczające na emoji */
        font-size: 1.5em; /* Zwiększ rozmiar czcionki dla emoji */
        width: 50px; /* Stała szerokość */
        height: 50px; /* Stała wysokość, aby były kwadratowe */
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .superpower-button .superpower-text {
        display: none; /* Ukryj tekstową część przycisku na mobilnych */
    }

    #shop-button {
        top: 10px;
        right: 10px;
        padding: 8px 15px;
        font-size: clamp(0.6em, 2.5vw, 1em);
    }

    .upgrade-category {
        width: clamp(200px, 80vw, 400px);
        padding: 10px 15px;
    }

    .upgrade-category h3 {
        font-size: clamp(0.8em, 3vw, 1.2em);
    }

    .upgrade-category p {
        font-size: clamp(0.6em, 2.5vw, 0.9em);
    }

    .upgrade-category button {
        padding: 6px 12px;
    }

    /* ZMIANA: Pozycja komunikatów na mobilnych (nad Stonksem) i zmniejszenie czcionki */
    .knockout-message, .boss-message {
        top: 25%; /* Przeniesienie wyżej, nad Stonksa */
        font-size: clamp(0.7em, 3vw, 1.2em); /* Zmniejszona czcionka dla mobilnych */
        padding: 12px 18px; /* Zmniejszony padding */
    }
}

/* Nowa sekcja: Media query dla DESKTOP - wiadomości niżej */
@media (min-width: 769px) {
    .knockout-message, .boss-message {
        top: 80%; /* Przesunięcie niżej, pod Stonksa */
        /* Transformacja pozostaje translate(-50%, -50%) aby nadal centrować */
    }
}
